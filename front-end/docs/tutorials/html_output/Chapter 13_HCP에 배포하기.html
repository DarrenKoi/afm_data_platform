<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 13_HCP에 배포하기</title>
    
    <style>
    body {
        font-family: 'Malgun Gothic', '맑은 고딕', 'Noto Sans CJK KR', 'Dotum', '돋움', 'Gulim', '굴림', Arial, sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 900px;
        margin: 0 auto;
        padding: 40px 20px;
        background-color: #fff;
    }
    
    h1, h2, h3, h4, h5, h6 {
        color: #2c3e50;
        margin-top: 2em;
        margin-bottom: 1em;
        text-align: left;
    }
    
    h1 {
        border-bottom: 3px solid #3498db;
        padding-bottom: 10px;
        text-align: center;
        margin-bottom: 2em;
    }
    
    h2 {
        border-bottom: 2px solid #ecf0f1;
        padding-bottom: 8px;
    }
    
    p {
        margin-bottom: 1em;
        text-align: justify;
    }
    
    code {
        background-color: #f1f3f4;
        border: 1px solid #e1e4e8;
        border-radius: 3px;
        padding: 2px 6px;
        font-family: 'Consolas', 'Monaco', 'Courier New', 'D2Coding', 'Nanum Gothic Coding', monospace;
        font-size: 0.9em;
        color: #24292e;
    }
    
    pre {
        background-color: #f6f8fa;
        border: 1px solid #e1e4e8;
        border-radius: 6px;
        padding: 16px;
        overflow-x: auto;
        margin: 1em 0;
        line-height: 1.45;
        font-family: 'Consolas', 'Monaco', 'Courier New', 'D2Coding', 'Nanum Gothic Coding', monospace;
    }
    
    pre code {
        background: none;
        border: none;
        padding: 0;
        color: inherit;
        font-size: 0.9em;
    }
    
    /* Enhanced syntax highlighting support */
    .highlight {
        background-color: #f6f8fa;
        border-radius: 6px;
        margin: 1em 0;
    }
    
    .highlight pre {
        background: none;
        border: none;
        margin: 0;
    }
    
    /* Fix Vue.js template syntax highlighting issues */
    .highlight .err {
        background: none !important;
        border: none !important;
        color: #24292e !important;
    }
    
    /* Override error highlighting for Vue directives */
    .highlight .nt {
        color: #22863a;
    }
    
    .highlight .na {
        color: #6f42c1;
    }
    
    table {
        border-collapse: collapse;
        width: 100%;
        margin: 1.5em auto;
    }
    
    table th, table td {
        border: 1px solid #ddd;
        padding: 12px 8px;
        text-align: left;
    }
    
    table th {
        background-color: #f2f2f2;
        font-weight: bold;
        text-align: center;
    }
    
    blockquote {
        border-left: 4px solid #3498db;
        margin: 1em 0;
        padding-left: 20px;
        color: #7f8c8d;
        font-style: italic;
    }
    
    ul, ol {
        margin: 1em 0;
        padding-left: 2em;
    }
    
    li {
        margin-bottom: 0.5em;
    }
    
    hr {
        border: none;
        height: 2px;
        background-color: #ecf0f1;
        margin: 3em 0;
    }
    
    img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 1em auto;
        border-radius: 5px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .highlight {
        background-color: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 5px;
        padding: 10px;
        margin: 1em 0;
    }
    
    @media print {
        body {
            max-width: none;
            margin: 0;
            padding: 20px;
        }
    }
    </style>
    
</head>
<body>
    <h1 id="chapter-12">Chapter 12: 사내 클라우드에 배포하기</h1>
<h2 id="_1">들어가며</h2>
<p>이전 장에서는 개발 환경에서 Flask(백엔드)와 Vue(프론트엔드)를 별도의 포트에서 실행하는 방법을 배웠습니다. 이번 장에서는 <strong>운영 환경</strong>에서 Flask 서버가 Vue의 빌드된 정적 파일(dist 폴더)을 직접 서빙하는 <strong>통합 배포</strong> 방법을 알아보겠습니다.</p>
<h2 id="1">1. 배포 아키텍처의 이해</h2>
<h3 id="11-vs">1.1 개발 환경 vs 운영 환경</h3>
<p><strong>개발 환경 (Development)</strong></p>
<div class="highlight"><pre><span></span><code>┌─────────────────┐                    ┌──────────────────┐
│   Vue Dev       │  API Request       │   Flask Dev      │
│   Server        │ ────────────────►  │   Server         │
│   (Port 3000)   │ ◄────────────────  │   (Port 5000)    │
└─────────────────┘  JSON Response     └──────────────────┘
</code></pre></div>

<p><strong>운영 환경 (Production)</strong></p>
<div class="highlight"><pre><span></span><code>┌─────────────────┐
│   사용자 브라우저  │
└────────┬────────┘
         │ HTTP Request
         ▼
┌─────────────────┐
│   Flask Server  │
│   (Port 5000)   │
├─────────────────┤
│ - API Endpoints │ ──► /api/* → API 처리
│ - Static Files  │ ──► /* → Vue 정적 파일 서빙
└─────────────────┘
</code></pre></div>

<h3 id="12">1.2 통합 배포의 장점</h3>
<ol>
<li><strong>단일 서버</strong>: 하나의 Flask 서버로 모든 요청 처리</li>
<li><strong>간편한 배포</strong>: 하나의 애플리케이션만 관리</li>
<li><strong>CORS 불필요</strong>: 같은 도메인에서 서비스되므로 CORS 설정 불필요</li>
<li><strong>보안 강화</strong>: API와 프론트엔드가 같은 도메인에서 실행</li>
</ol>
<h2 id="2-vue">2. Vue 애플리케이션 빌드</h2>
<h3 id="21">2.1 프로덕션 빌드 생성</h3>
<p>Vue 애플리케이션을 배포용으로 빌드합니다:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># front-end 디렉토리로 이동</span>
<span class="nb">cd</span><span class="w"> </span>front-end

<span class="c1"># 프로덕션 빌드 실행</span>
npm<span class="w"> </span>run<span class="w"> </span>build
</code></pre></div>

<p>빌드가 완료되면 <code>front-end/dist</code> 폴더가 생성됩니다:</p>
<div class="highlight"><pre><span></span><code>front-end/
└── dist/
    ├── index.html          # Vue 앱의 진입점
    ├── favicon.ico         # 파비콘
    ├── assets/            # JS, CSS, 이미지 등
    │   ├── index-xxxx.js  # 번들된 JavaScript
    │   └── index-xxxx.css # 번들된 CSS
    └── ...
</code></pre></div>

<h3 id="22">2.2 환경 변수 확인</h3>
<p>빌드 전에 <code>.env.production</code> 파일을 확인합니다:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># .env.production</span>
<span class="nv">VITE_API_BASE_URL</span><span class="o">=</span>http://your-domain.skhynix.com/api<span class="w">  </span><span class="c1"># (할당 받은 도메인 + /api)</span>
</code></pre></div>

<h2 id="3-flask-indexpy">3. Flask 서버 설정 (index.py 분석)</h2>
<h3 id="31-flask">3.1 Flask 애플리케이션 생성</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_app</span><span class="p">():</span>
    <span class="c1"># Vue 빌드 파일이 있는지 확인</span>
    <span class="n">static_folder</span> <span class="o">=</span> <span class="s1">&#39;front-end/dist&#39;</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;front-end/dist&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="n">static_folder</span><span class="p">,</span> <span class="n">static_url_path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</code></pre></div>

<ul>
<li><code>static_folder</code>: Vue 빌드 파일들이 있는 디렉토리 지정</li>
<li><code>static_url_path=''</code>: 정적 파일 경로 접두사를 비움 (기본값은 <code>/static</code>)</li>
</ul>
<h3 id="32-cors">3.2 CORS 설정</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 개발과 운영 환경을 위한 CORS 설정</span>
<span class="n">allowed_origins</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;http://localhost:3000&#39;</span><span class="p">,</span>  <span class="c1"># Vue 개발 서버</span>
    <span class="s1">&#39;http://localhost:5173&#39;</span><span class="p">,</span>  <span class="c1"># Vite 기본 포트</span>
    <span class="s1">&#39;http://localhost:5000&#39;</span><span class="p">,</span>  <span class="c1"># Flask 자체</span>
    <span class="c1"># 운영 환경에서는 할당받은 도메인 URL 추가</span>
    <span class="c1"># &#39;http://afm-platform.skhynix.com&#39;,</span>
<span class="p">]</span>

<span class="n">CORS</span><span class="p">(</span><span class="n">app</span><span class="p">,</span>
     <span class="n">origins</span><span class="o">=</span><span class="n">allowed_origins</span><span class="p">,</span>
     <span class="n">allow_headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Authorization&#39;</span><span class="p">,</span> <span class="s1">&#39;X-Requested-With&#39;</span><span class="p">,</span> <span class="s1">&#39;Accept&#39;</span><span class="p">],</span>
     <span class="n">supports_credentials</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="33-vue">3.3 Vue 정적 파일 서빙</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Vue 빌드 파일이 있을 때만 실행</span>
<span class="k">if</span> <span class="n">static_folder</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;front-end/dist&#39;</span><span class="p">):</span>
    <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
    <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&lt;path:path&gt;&#39;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">serve_vue_app</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="c1"># API 경로는 제외</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;api/&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Not found&#39;</span><span class="p">},</span> <span class="mi">404</span>

        <span class="c1"># 실제 파일이 있으면 해당 파일 반환</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;front-end/dist&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="s1">&#39;front-end/dist&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

        <span class="c1"># 그 외 모든 경로는 index.html 반환 (Vue Router가 처리)</span>
        <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="s1">&#39;front-end/dist&#39;</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</code></pre></div>

<p>이 설정으로:</p>
<ul>
<li><code>/api/*</code> 경로는 API 블루프린트가 처리</li>
<li>실제 파일(JS, CSS, 이미지 등)은 해당 파일 반환</li>
<li>그 외 모든 경로는 <code>index.html</code> 반환 → Vue Router가 클라이언트 측에서 라우팅 처리</li>
</ul>
<h2 id="4-hcp">4. HCP에 배포</h2>
<p>HCP web app의 front-end/dist 폴더에 npm run build를 통해 생성된 파일들을 업로드합니다.</p>
<div class="highlight"><pre><span></span><code>afm_data_platform/
├── index.py              # Flask 진입점 (UWSGI가 찾는 파일)
├── api/                  # API 라우트
├── front-end/
│   └── dist/            # Vue 빌드 결과물
├── requirements.txt      # Python 의존성
└── uwsgi.ini            # UWSGI 설정 (선택사항)
</code></pre></div>
</body>
</html>